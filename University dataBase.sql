-- =========================
-- DROP TABLES (reset order)
-- =========================
DROP TABLE REGISTRATION CASCADE CONSTRAINTS;
DROP TABLE LECTURE CASCADE CONSTRAINTS;
DROP TABLE SUBJECT CASCADE CONSTRAINTS;
DROP TABLE QUALIFICATION CASCADE CONSTRAINTS;
DROP TABLE FACULTY CASCADE CONSTRAINTS;
DROP TABLE STUDENT CASCADE CONSTRAINTS;
DROP TABLE STAFF CASCADE CONSTRAINTS;

CREATE TABLE STAFF(
 STAFFNR NUMBER(6) NOT NULL PRIMARY KEY,
 SURNAME VARCHAR2(15),
 INITIALS VARCHAR2(4),
 OFFICE_NR VARCHAR2(3),
 JOB VARCHAR2(15),
 SALARY NUMBER(8,2),
 BONUS NUMBER(8,2) 
);

CREATE TABLE FACULTY(
 FAC_CODE CHAR(2) NOT NULL PRIMARY KEY,
 FAC_NAME VARCHAR2(32),
 FAC_HEAD NUMBER(6),
 CONSTRAINT uq_fac_head UNIQUE (FAC_HEAD),
    CONSTRAINT fk_faculty_head FOREIGN KEY (FAC_HEAD)
        REFERENCES STAFF (STAFFNR)
);

CREATE TABLE QUALIFICATION(
 QUAL_CODE CHAR(2) NOT NULL PRIMARY KEY,
 QUAL_NAME VARCHAR2(25),
 QUAL_HEAD NUMBER(6),
 FAC_CODE CHAR(2),
CONSTRAINT fk_qualification_fac FOREIGN KEY (FAC_CODE)
        REFERENCES FACULTY (FAC_CODE),
    CONSTRAINT fk_qualification_head FOREIGN KEY (QUAL_HEAD)
        REFERENCES STAFF (STAFFNR)
);
 
CREATE TABLE SUBJECT(
 SUBJ_CODE CHAR(3) NOT NULL PRIMARY KEY,
 SUBJ_NAME VARCHAR2(35),
 SUBJ_FEE NUMBER(6,2),
 HEADNR NUMBER(6),
 QUAL_CODE CHAR(2),
 PREREQ  CHAR(3),
 CONSTRAINT fk_subject_qual FOREIGN KEY (QUAL_CODE)
        REFERENCES QUALIFICATION (QUAL_CODE),
    CONSTRAINT fk_subject_head FOREIGN KEY (HEADNR)
        REFERENCES STAFF (STAFFNR)
);

CREATE TABLE LECTURE(
  SUBJ_CODE CHAR(3),
  LECTURER_NR  NUMBER(6),
CONSTRAINT uq_lecture_subj UNIQUE (SUBJ_CODE),
    CONSTRAINT uq_lecture_lecturer UNIQUE (LECTURER_NR),
    CONSTRAINT fk_lecture_subject FOREIGN KEY (SUBJ_CODE)
        REFERENCES SUBJECT (SUBJ_CODE),
    CONSTRAINT fk_lecture_staff FOREIGN KEY (LECTURER_NR)
        REFERENCES STAFF (STAFFNR)
);

CREATE TABLE STUDENT(
STUDNR NUMBER(8) NOT NULL PRIMARY KEY,
SURNAME VARCHAR2(15),
INITIALS VARCHAR2(15),
SEX CHAR(1),
BIRTHDATE DATE DEFAULT SYSDATE
);

CREATE TABLE REGISTRATION(
 STUDNR NUMBER(8) NOT NULL,
 SUBJ_CODE CHAR(3) NOT NULL ,
 REG_DATE DATE,
 CAMPUS CHAR(1),
 FINALMARK NUMBER(2),
 CONSTRAINT pk_registration PRIMARY KEY (STUDNR, SUBJ_CODE),
    CONSTRAINT fk_registration_student FOREIGN KEY (STUDNR)
        REFERENCES STUDENT (STUDNR),
    CONSTRAINT fk_registration_subject FOREIGN KEY (SUBJ_CODE)
        REFERENCES SUBJECT (SUBJ_CODE)
);

-- STAFF
INSERT INTO STAFF VALUES (100001, 'Mhlauli', 'SZ', 'A12', 'Dean', 85000, 5000);
INSERT INTO STAFF VALUES (100002, 'Nkosi', 'TB', 'B15', 'Lecturer', 45000, 2000);
INSERT INTO STAFF VALUES (100003, 'Dlamini', 'AY', 'C20', 'Lecturer', 47000, 2500);
INSERT INTO STAFF VALUES (100004, 'Peters', 'JP', 'D05', 'Admin', 30000, 1000);

-- FACULTY
INSERT INTO FACULTY VALUES ('SC', 'Science Faculty', 100001);
INSERT INTO FACULTY VALUES ('AR', 'Arts Faculty', 100004);

-- QUALIFICATION
INSERT INTO QUALIFICATION VALUES ('CS', 'Computer Science', 100002, 'SC');
INSERT INTO QUALIFICATION VALUES ('EN', 'English Literature', 100003, 'AR');

-- SUBJECTS
INSERT INTO SUBJECT VALUES ('CSC', 'Database Systems', 2500, 100002, 'CS', NULL);
INSERT INTO SUBJECT VALUES ('PRG', 'Programming Fundamentals
', 2000, 100002, 'CS', NULL);
INSERT INTO SUBJECT VALUES ('ENG', 'Shakespeare Studies', 1800, 100003, 'EN', NULL);

-- LECTURES
INSERT INTO LECTURE VALUES ('CSC', 100002);
INSERT INTO LECTURE VALUES ('PRG', 100002);
INSERT INTO LECTURE VALUES ('ENG', 100003);

-- STUDENTS
INSERT INTO STUDENT VALUES (20230001, 'Smith', 'JO', 'M', DATE '2003-05-12');
INSERT INTO STUDENT VALUES (20230002, 'Johnson', 'AN', 'F', DATE '2004-08-21');
INSERT INTO STUDENT VALUES (20230003, 'Khumalo', 'SI', 'M', DATE '2002-11-30');

-- REGISTRATION
INSERT INTO REGISTRATION VALUES (20230001, 'CSC', SYSDATE, 'M', 85);
INSERT INTO REGISTRATION VALUES (20230001, 'PRG', SYSDATE, 'M', 78);
INSERT INTO REGISTRATION VALUES (20230002, 'ENG', SYSDATE, 'A', 90);
INSERT INTO REGISTRATION VALUES (20230003, 'CSC', SYSDATE, 'M', 65);

-- FINAL COMMIT
COMMIT;



